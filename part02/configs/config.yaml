# =========================
# Task name
# =========================
task_name: navier_stokes_synthetic

# =========================
# Random seed
# =========================
seed: 1234

# =========================
# Paths (REQUIRED)
# =========================
paths:
  root_dir: .
  output_dir: ./outputs
  log_dir: ./logs
  data_dir: ./data
  rk_dir: ./data/irk_weights
  work_dir: .

# =========================
# Extras
# =========================
extras:
  enforce_tags: false
  print_config: true
  ignore_warnings: false

# =========================
# Number of sampled points
# =========================
n_train: 5000

# =========================
# Mesh / Point cloud
# =========================
mesh:
  _target_: pinnstorch.data.PointCloud
  root_dir: .
  read_data_fn: ???

# =========================
# Training datasets
# =========================
train_datasets:
  - mesh_sampler:
      _target_: pinnstorch.data.MeshSampler
      _partial_: true
      num_sample: ${n_train}
      collection_points:
        - f_u
        - f_v

# =========================
# DataModule (ðŸ”´ OBLIGATOIRE)
# =========================
data:
  _target_: pinnstorch.data.PINNDataModule

# =========================
# Neural network
# =========================
net:
  _target_: pinnstorch.models.FCN
  _partial_: true         # âœ… FIX: obligatoire sinon FCN rÃ©clame lb/ub
  layers: [3, 20, 20, 20, 20, 20, 20, 20, 20, 2]
  output_names:
    - psi
    - p

# =========================
# Model (PINN)
# =========================
# =========================
# Model (PINN)  âœ… FIX
# =========================
# =========================
# Model (PINN) âœ… CORRECT FINAL
# =========================
# =========================
# Model (PINN) âœ… CORRECT FINAL
# =========================
# =========================
# Model (PINN) âœ… FINAL ABSOLU
# =========================
model:
  _target_: PINN   # ðŸ”´ requis UNIQUEMENT pour le logging interne
  lazy: false
  loss_fn: sse
  jit_compile: false
  amp: false
  cudagraph_compile: false
  inline: false

  optimizer:
    _target_: torch.optim.Adam
    _partial_: true
    lr: 0.001
    weight_decay: 0.0
    capturable: false

  extra_variables:
    l1: 1.0
    l2: 0.01




# =========================
# Trainer (Lightning)
# =========================
trainer:
  _target_: lightning.pytorch.trainer.Trainer
  accelerator: cpu
  devices: 1
  max_epochs: 200000
  log_every_n_steps: 1
  enable_progress_bar: true
  deterministic: false
  num_sanity_val_steps: 0
  limit_val_batches: 0

# =========================
# Mode flags
# =========================
train: true
val: false
test: false
ckpt_path: null

# =========================
# Optimized metric
# =========================
optimized_metric:
  residual:
    - f_u
    - f_v
  extra_variables:
    - l1
    - l2

# =========================
# Callbacks
# =========================
callbacks:
  model_checkpoint:
    _target_: lightning.pytorch.callbacks.ModelCheckpoint
    dirpath: ${paths.output_dir}/checkpoints
    filename: epoch_{epoch:06d}
    save_last: true
    save_top_k: 1
    monitor: train/loss
    mode: min

# =========================
# Logger
# =========================
logger:
  csv:
    _target_: lightning.pytorch.loggers.csv_logs.CSVLogger
    save_dir: ${paths.output_dir}
    name: csv

