# =========================
# Task name
# =========================
task_name: shell_3d_pointcloud

# =========================
# Random seed
# =========================
seed: 1234

# =========================
# Paths
# =========================
paths:
  root_dir: .
  output_dir: ./outputs
  log_dir: ./logs
  data_dir: ./data
  rk_dir: ./data/irk_weights
  work_dir: .

extras:
  enforce_tags: false
  print_config: true
  ignore_warnings: false

# =========================
# Number of sampled points per epoch
# =========================
n_train: 8000

# =========================
# PointCloud
# =========================
mesh:
  _target_: pinnstorch.data.PointCloud
  root_dir: .
  read_data_fn: ???

# =========================
# Training datasets
# =========================
train_datasets:
  - pde_sampler:
      _target_: pinnstorch.data.MeshSampler
      _partial_: true
      num_sample: ${n_train}
      collection_points:
        - f_u
        - f_bc

# =========================
# DataModule
# =========================
data:
  _target_: pinnstorch.data.PINNDataModule
  batch_size: 1024
  num_workers: 0
  pin_memory: false

# =========================
# Neural network
# =========================
net:
  _target_: pinnstorch.models.FCN
  _partial_: true
  # input: x,y,z,t = 4 dims ; output: u = 1
  layers: [4, 64, 64, 64, 64, 1]
  output_names:
    - u

# =========================
# Model (PINN)
# =========================
model:
  _target_: pinnstorch.models.PINNModule
  _partial_: true
  lazy: false
  loss_fn: sse
  jit_compile: false
  amp: false
  cudagraph_compile: false
  inline: false

  optimizer:
    _target_: torch.optim.Adam
    _partial_: true
    lr: 0.001
    weight_decay: 0.0
    capturable: false

  extra_variables:
    alpha: 0.01

# =========================
# Trainer
# =========================
trainer:
  _target_: lightning.pytorch.trainer.Trainer
  accelerator: cpu
  devices: 1
  max_epochs: 50000
  log_every_n_steps: 1
  enable_progress_bar: true
  deterministic: false
  num_sanity_val_steps: 0
  limit_val_batches: 0

train: true
val: false
test: false
ckpt_path: null

# =========================
# Optimized metric (for logging/selection)
# =========================
optimized_metric:
  residual:
    - f_u
    - f_bc
  extra_variables:
    - alpha

logger:
  csv:
    _target_: lightning.pytorch.loggers.csv_logs.CSVLogger
    save_dir: ${paths.output_dir}
    name: csv
